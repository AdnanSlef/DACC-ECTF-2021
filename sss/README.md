# 0xDACC SCEWL Security Server (SSS)
The SCEWL Security Server supports registration and deregistration functionality
for SCEWL Enabled Devices. It also includes scripts to support the creation
of SCEWL deployments. The SSS is one of two components our team had to implement
(the other being the SCEWL Bus Controller in `/controller/`).

## Files
The SCEWL Security Server uses several files:

* `sss.py`: Implements the main functionality of the SCEWL Security Server. It runs
  in a loop, registering and deregistering SEDs.
* `helper.py`: Helps with deployment, performing tasks for `create_deployment`, `add_sed`,
  and `remove_sed`.
* `/secrets`: On the SSS docker, the `/secrets` directory is used for data storage, including
  sensitive information.
* `/secrets/depl_id_{id}`: The secrets file assigned to a deployment id. This is created at
  `create_deployment` and will be assigned to an SED at `add_sed`.
* `/secrets/{SCEWL_ID}.secret`: The secrets file assigned to an SED. Each is equivalent to
  one of the deployment secrets files.
* `/secrets/mapping`: Maps between SCEWL IDs and deployment IDs. Updated at `add_sed` and `remove_sed`.
* `/secrets/auth`: Stores the authorization tokens for registration/deregistration of each SED.
  Created at `create_deployment` and updated at `remove_sed`.
* `/secrets/{id}.crypt`: Stores unlock keys on disk for the SED.
* `/secrets/{id}.seqs`: Stores sequence numbers on disk for the SED.

## Data Fields
The SSS interacts with the SCEWL Bus Controllers during registration and deregistration.
The following fields are exchanged in these messages (see `/controller/controller.h` for structs):

* `seq`:
  * set to 1 at `create_deployment` in depl secrets and .seqs file
  * stored in .seqs file at deregistration
  * retrieved from .seqs file at registration
* `KNOWN_SEQS[256]`:
  * set to all zeroes at `create_deployment` in depl secrets and .seqs file
  * stored in .seqs file at deregistration
  * retrieved from .seqs file at registration
* `cryptkey, cryptiv`:
  * set in .crypt file at `create_deployment`
  * used to lock ECC keys at `create_deployment`
  * retrieved from .crypt file at registration
* `entropky, entriv`:
  * randomly generated at registration
* `depl_nonce`:
  * randomly generated at `deploy`
  * retrieved from SSS RAM at registration
* `SCEWL_IDS_DB[256]`:
  * `/secrets/mapping` updated at `add_sed` and `remove_sed`
  * mapping pulled to SSS RAM at `deploy`
  * `SCEWL_IDS_DB` generated by SSS at registration:
  * at each index (depl\_id),
    * mapped scewl\_id if this depl\_id is mapped to a scewl\_id
    * BAD\_ID = this SED's SCEWL\_ID if unmapped
* `AUTH`:
  * randomly generated at `create_deployment` in depl secrets and `/secrets/auth`
  * dict pulled to SSS RAM at `deploy`, `{scewl_id : auth_token}`
  * verified at registration and deregistration before performing operation
  * clobbered at `remove_sed`
